---
const id = import.meta.env.PUBLIC_GOOGLE_ANALYTICS_ID;
const shouldInjectAnalytics = import.meta.env.PROD && Boolean(id);
---
{
  shouldInjectAnalytics && (
    <>
      <script async src={`https://www.googletagmanager.com/gtag/js?id=${id}`} is:inline></script>
      <script define:vars={{ id }} is:inline>
        window.dataLayer = window.dataLayer || [];
        function gtag() {
          window.dataLayer.push(arguments);
        }

        gtag('js', new Date());

        const consentDefaults = window.__gaConsentDefaults;
        if (consentDefaults && typeof consentDefaults === 'object') {
          gtag('consent', 'default', consentDefaults);
        }

        gtag('config', id);
      </script>
    </>
  )
}
